# Flawed enforcement of business rules

## Theory

<h3>Недостатки домена</h3>

Во многих случаях вы столкнетесь с логическими ошибками, специфичными для бизнес-домена или цели сайта.

Дисконтная функциональность интернет-магазинов — классическая поверхность атаки при поиске логических ошибок. Это может быть потенциальной золотой жилой для злоумышленника, поскольку в способах применения скидок возникают всевозможные основные логические недостатки.

Например, рассмотрим интернет-магазин, который предлагает 10% скидку при заказе на сумму более 1000 долларов. Это может быть уязвимо для злоупотреблений, если бизнес-логика не может проверить, был ли изменен заказ после применения скидки. В этом случае злоумышленник может просто добавлять товары в свою корзину, пока не достигнет порога в 1000 долларов, а затем удалить ненужные товары перед размещением заказа. Затем они получат скидку на свой заказ, даже если он больше не соответствует предполагаемым критериям.

Вам следует уделять особое внимание любой ситуации, когда цены или другие конфиденциальные значения корректируются на основе критериев, определяемых действиями пользователя. Попытайтесь понять, какие алгоритмы использует приложение для внесения этих корректировок и в какой момент эти корректировки выполняются. Это часто связано с манипулированием приложением, чтобы оно находилось в состоянии, когда примененные корректировки не соответствуют исходным критериям, задуманным разработчиками.

Чтобы выявить эти уязвимости, нужно хорошо подумать о том, какие цели могут быть у злоумышленника, и попытаться найти разные способы их достижения, используя предоставленный функционал. Это может потребовать определенного уровня знаний в предметной области, чтобы понять, что может быть выгодно в данном контексте. Чтобы использовать простой пример, вам нужно понимать социальные сети, чтобы понять преимущества принуждения большого количества пользователей следовать за вами.

Не зная предметной области, вы можете игнорировать опасное поведение, потому что просто не знаете о его возможных побочных эффектах. Точно так же вы можете изо всех сил пытаться соединить точки и заметить, как две функции могут сочетаться вредным образом. Для простоты примеры, используемые в этом разделе, относятся к домену, с которым все пользователи уже знакомы, а именно к интернет-магазину. Однако независимо от того, занимаетесь ли вы поиском ошибок, пентестом или даже просто разработчиком, пытающимся написать более безопасный код, в какой-то момент вы можете столкнуться с приложениями из менее знакомых областей. В этом случае вы должны прочитать как можно больше документации и, если возможно, поговорить с экспертами в данной области, чтобы узнать их мнение. Это может показаться большой работой, но чем менее ясен домен, тем больше вероятность того, что другие тестировщики пропустят множество ошибок.

## Writeup

* Имеющиеся данные: 
    * Данные нашего аккаунта: wiener:peter

Главная страница:

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/1.png)

Логинимся с имеющимися данными

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/2.png)

На главной странице перейдем в ее конец. Подписываемся на новостную рассылку, введя случайные данные почты.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/3.png)

Получаем промокод.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/4.png)

Добавляем требуемый продукт в корзину. 

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/5.png)

Перейдем в корзину. Добавляем имеющиеся промокоды по очереди, чтобы не возникало ошибки.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/6.png)

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/7.png)

Оставляем заказ и получаем ответ от сервера.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/8.png)

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/Business_logic_vulnerabilities/Flawed_enforcement_of_business_rules/assets/9.png)
