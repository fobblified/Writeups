# Exploiting XInclude to retrieve files

## Theory

<h3>XInclude атаки</h3>

Некоторые приложения получают данные, отправленные клиентом, встраивают их на стороне сервера в XML-документ, а затем анализируют документ. Пример этого возникает, когда данные, отправленные клиентом, помещаются во внутренний запрос SOAP, который затем обрабатывается серверной службой SOAP.

В этой ситуации вы не можете выполнить классическую атаку XXE, потому что вы не контролируете весь XML-документ и поэтому не можете определить или изменить элемент DOCTYPE. Однако вместо этого вы можете использовать XInclude. XInclude — это часть спецификации XML, которая позволяет создавать XML-документ из вложенных документов. Вы можете поместить атаку XInclude в любое значение данных в XML-документе, поэтому атака может быть выполнена в ситуациях, когда вы контролируете только один элемент данных, помещенный в XML-документ на стороне сервера.

Чтобы выполнить атаку XInclude, вам необходимо сослаться на пространство имен XInclude и указать путь к файлу, который вы хотите включить. Например:
```
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>
```

## Writeup

Главная страница:

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/1.png)

Выберем любой продукт.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/2.png)

Перейдем на его страницу и спустимся в самый низ.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/3.png)

Нажмем на кнопку "Check stock" и перехватим запрос. Отправляем его в Repeater.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/4.png)

Модифицируем запрос. Код экплоита:
```
<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>
```

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/5.png)

Получаем ответ от сервера.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XInclude_to_retrieve_files/assets/6.png)
